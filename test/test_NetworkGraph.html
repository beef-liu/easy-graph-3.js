<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Test NetworkGraph</title>

        <script src='../lib/jquery-1.9.1.min.js'></script>
        
        <script src='../lib/three.min.js'></script>
        <script src='../lib/Detector.js'></script>
        <script src='../lib/stats.min.js'></script>
        <script src='../lib/OrbitControls.js'></script>
        <script src='../lib/THREEx.KeyboardState.js'></script>
        <script src='../lib/THREEx.FullScreen.js'></script>
        <script src='../lib/THREEx.WindowResize.js'></script>
        
        <script src='../src/EasyGraph3.js'></script>
        <script src='../src/JsUtils.js'></script>
        <script src='../src/NetworkGraph.js'></script>
        
        <script src='ThreeJsHelper.js'></script>

        <script>
            var _threeJsHelper;
            var FPS = 30;
            var MAX_ANIMATE_INTERVAL = 1000 / 60;
            //var ANIMATE_INTERVAL_DELAY = Math.max(Math.ceil(1000 / FPS - MAX_ANIMATE_INTERVAL), 0);
            var ANIMATE_INTERVAL_DELAY = Math.ceil(1000 / FPS) - 5;
            
            function animate() {
                var timeout = setTimeout(
                    function() {
                        requestAnimationFrame(animate);
                        _threeJsHelper.redraw();
                        
                        clearTimeout(timeout);
                    }, ANIMATE_INTERVAL_DELAY);
            }
            
            var _gridDist;
            {
                var gridWidth = 100;
                _gridDist = new EG3.GridPositionDistribution(gridWidth);
            }
            
            var _sphereDist;
            var maxCount = 300;
            {
                var originPoint = {x: 0, y: 0, z: 0};
                var direction = {x: 0, y: 0, z: 1};
                var space = 30;
                var fov = 90;
                _sphereDist = new EG3.SpherePositionDistribution(originPoint, direction, maxCount, space, fov);
            }

            var _gridSphereDist;
            {
                var gridWidth = 100;
                var center = new THREE.Vector3(0, 0, -1000);
                var surfaceCenter = new THREE.Vector3(100, 200, 150);
                _gridSphereDist = new EG3.GridSpherePositionDistribution(gridWidth, center, surfaceCenter);
            }            
            
            var _networkGraph;
            
            var BallRadius = 10;

            
            $(document).ready(function() {
                _threeJsHelper = new ThreeJsHelper({
                    container: $('#glscene')[0],
                });
                
                animate();

                _threeJsHelper.camera.position.set(200, 500, 1000);

                //create material and geom -----------------------------
                var color = 0xff0000;
                var mat = new THREE.MeshBasicMaterial({color: color});
                var geom = new THREE.SphereGeometry(BallRadius);
                
                //test 1
                $('#btnTestGridDistribute').click(function() {
                    var pos = _gridDist.nextPosition(); 
                    var ball = new THREE.Mesh(geom, mat);
                    ball.position.set(pos.x, pos.y, pos.z);
                    
                    _threeJsHelper.scene.add(ball);
                });
                
                //test 2
                $('#btnTestSphereDistribute').click(function() {
                    for(var i = 0; i < maxCount; i++) {
                        var pos = _sphereDist.nextPosition(); 
                        var ball = new THREE.Mesh(geom, mat);
                        ball.position.set(pos.x, pos.y, pos.z);
                        _threeJsHelper.scene.add(ball);
                    }
                    
                });

                //test3 
                $('#btnTestGridSphereDistribute').click(function() {
                    for(var i = 0; i < maxCount; i++) {
                        var pos = _gridSphereDist.nextPosition(); 
                        var ball = new THREE.Mesh(geom, mat);
                        ball.position.set(pos.x, pos.y, pos.z);
                        _threeJsHelper.scene.add(ball);
                    }
                });
                
                
                //create networkgraph
                _networkGraph = new EG3.NetworkGraph({
                    scene: _threeJsHelper.scene,
                });
                
                //test4 
                $('#btnTestNetworkGraph').click(function() {
                    var graphNodes = [];
                    
                    _networkGraph.reloadGraphNodes(graphNodes);
                });
            });
            
            function test1() {
                var ball = new THREE.Object3D();
                
                ball.add(createBall(0xff0000, 0, 0, 0));
                ball.add(createBall(0xff0000, 0, 100, 0));
                ball.add(createBall(0xff0000, 0, 200, 0));
                
                ball.position.set(-150, 0, 0);
                
                _threeJsHelper.scene.add(ball);
            }
            
            function createBall(color, x, y, z) {
                var mat = new THREE.MeshBasicMaterial({color: color});
                var geom = new THREE.SphereGeometry(50);
                var ball = new THREE.Mesh(geom, mat);
                ball.position.set(x, y, z);
             
                return ball;   
            }
            
        </script>

    </head>

    <body>
        <div style="position: absolute; top: 0px; left: 0px; width: 100%; height: 28px; background-color: #e1e1e1; padding: 2px 6px 2px 6px; margin: 0px; font-size: larger;">
            <input type="button" id="btnTestGridDistribute" value="Test GridPositionDistribution" style=" font-size: larger;"/>
            <input type="button" id="btnTestSphereDistribute" value="Test SpherePositionDistribution" style=" font-size: larger;"/>
            
            <input type="button" id="btnTestGridSphereDistribute" value="Test GridSpherePositionDistribution" style=" font-size: larger;"/>
            <input type="button" id="btnTestNetworkGraph" value="Test NetworkGraph" style=" font-size: larger;"/>
        </div>
        <div id="glscene" style="position: absolute; left:0px; top:30px; bottom: 0px;"></div>
    </body>
</html>